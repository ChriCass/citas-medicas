# PASOS DE INSTALACIÃ“N - SISTEMA DE CITAS MÃ‰DICAS CON ELOQUENT ORM

## ğŸ“‹ PREPARACIÃ“N INICIAL

### 1. ConfiguraciÃ³n del Entorno
```bash
# Copiar archivo de configuraciÃ³n
cp .env.example .env
```

### 2. Configurar Base de Datos en .env
```env
# Para SQL Server
DB_CONNECTION=sqlsrv
DB_HOST=localhost
DB_PORT=1433
DB_DATABASE=med_database_v5
DB_USERNAME=tu_usuario
DB_PASSWORD=tu_password

# Para MySQL (alternativa)
DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=med_database_v5
DB_USERNAME=tu_usuario
DB_PASSWORD=tu_password
```

### 3. Instalar Dependencias de Eloquent ORM
```bash
# Instalar Eloquent y dependencias relacionadas
composer require illuminate/database
composer require illuminate/events
composer require nesbot/carbon

# Regenerar autoloader
composer dump-autoload
```

## ğŸ—„ï¸ CONFIGURACIÃ“N DE BASE DE DATOS

### 4. Configurar Base de Datos (SQL Server)
1. Crea una nueva base de datos llamada `med_database_v5` en tu SQL Server
2. Ejecuta el script completo del archivo `sql/SQLServer_EspaÃ±ol/schema.sql` que incluye:
   - CreaciÃ³n de todas las tablas
   - InserciÃ³n de datos de prueba (usuarios, roles, especialidades, etc.)
   - ConfiguraciÃ³n de relaciones y constraints

### 5. Alternativa MySQL
Si prefieres usar MySQL, ejecuta:
```sql
-- Crear la base de datos
CREATE DATABASE med_database_v5;

-- Ejecutar el script de MySQL
mysql -u usuario -p med_database_v5 < sql/mysql/schema.sql
```

## âš™ï¸ CONFIGURACIÃ“N DE ELOQUENT

### 6. InicializaciÃ³n AutomÃ¡tica
El sistema estÃ¡ configurado para inicializar Eloquent automÃ¡ticamente:
- `app/Core/Eloquent.php` - ConfiguraciÃ³n principal
- `app/Core/Database.php` - Fallback para compatibilidad
- Todos los modelos heredan de `BaseModel` con funcionalidades Eloquent

### 7. Verificar InstalaciÃ³n
```bash
# Ejecutar test completo del sistema de citas mÃ©dicas
php test_sistema_citas.php
```

El test debe mostrar **69/69 pruebas exitosas (100%)** y verificar:
- âœ… ConexiÃ³n a base de datos y configuraciÃ³n
- âœ… Usuarios demo `@demo.local` funcionando
- âœ… AutenticaciÃ³n con contraseÃ±a "password"
- âœ… Control de acceso por roles
- âœ… Flujo completo de citas mÃ©dicas
- âœ… GestiÃ³n de doctores y especialidades
- âœ… Operaciones de pacientes, cajeros y superadmin
- âœ… Validaciones de lÃ³gica de negocio

## ğŸš€ EJECUTAR EL SISTEMA

### 8. Iniciar Servidor
```bash
# Servidor de desarrollo PHP
php -S localhost:8000 -t public
```

### 9. Acceder al Sistema
- **URL**: http://localhost:8000
- **Usuarios Demo** (password: `password`):
  - super@demo.local (superadmin)
  - doctor@demo.local (doctor)
  - paciente@demo.local (paciente)
  - cajero@demo.local (cajero)

### 10. Usuarios de ProducciÃ³n
TambiÃ©n disponibles para pruebas avanzadas:
  - super@clinicasanjose.com
  - doctor@clinicasanjose.com  
  - paciente@clinicasanjose.com
  - cajero@clinicasanjose.com

## ğŸ‘¥ ROLES Y PERMISOS

### SUPERADMIN
- âœ… Ver todas las citas
- âœ… Crear nuevas citas (/citas/create)
- âœ… Gestionar doctores y horarios
- âœ… Acceso completo al sistema

### DOCTOR
- âœ… Ver todas las citas del sistema
- âŒ No puede crear citas
- âŒ No puede cambiar estados de citas
- âœ… Gestionar sus horarios

### PACIENTE  
- âœ… Ver solo sus propias citas
- âŒ No puede crear citas
- âŒ No puede cambiar estados
- âœ… Cancelar citas (con restricciones de tiempo)

### CAJERO
- âœ… Ver todas las citas
- âœ… Cambiar estados de citas (pendiente/confirmado/cancelado)
- âŒ No puede crear nuevas citas
- âœ… Gestionar pagos y confirmaciones

## ğŸ”§ CARACTERÃSTICAS DE ELOQUENT

### Beneficios Implementados
- **Relaciones automÃ¡ticas**: User->Doctor, Doctor->Especialidad, etc.
- **Query Builder avanzado**: Consultas complejas simplificadas
- **Eager Loading**: Carga eficiente de relaciones
- **Accessors/Mutators**: TransformaciÃ³n automÃ¡tica de datos
- **Transacciones**: Operaciones seguras en BD
- **Validaciones**: Reglas de negocio integradas

### Modelos Disponibles
- `User` - GestiÃ³n de usuarios con roles
- `Doctor` - Perfiles de doctores
- `Paciente` - Perfiles de pacientes  
- `Appointment` - Sistema de citas
- `Especialidad` - Especialidades mÃ©dicas
- `Sede` - Sedes y ubicaciones
- `Role` - Sistema de roles

## ğŸ§ª TESTING Y VALIDACIÃ“N

### Test Principal del Sistema
```bash
# Ejecutar test completo del sistema de citas mÃ©dicas
php test_sistema_citas.php
```

### Cobertura del Test (69 pruebas)
El test `test_sistema_citas.php` verifica **100% funcionalidad**:

#### ğŸ”§ **Infraestructura** (4 pruebas)
- ConexiÃ³n a base de datos (42 usuarios)
- ConfiguraciÃ³n de roles (4 roles)
- Especialidades mÃ©dicas (10 disponibles)
- Sedes mÃ©dicas (10 configuradas)

#### ğŸ‘¥ **Usuarios Demo** (12 pruebas)
- Existencia de usuarios `@demo.local`
- Roles asignados correctamente
- Perfiles especÃ­ficos creados (superadmin, doctor, paciente, cajero)

#### ğŸ” **AutenticaciÃ³n** (8 pruebas)
- Login con contraseÃ±a "password"
- Sistema de autenticaciÃ³n funcional
- ValidaciÃ³n para cada rol

#### ğŸ›¡ï¸ **Control de Acceso** (6 pruebas)
- Permisos de superadmin (acceso total)
- Permisos de doctor (citas mÃ©dicas)
- Permisos de paciente (citas propias)
- Permisos de cajero (operaciones bÃ¡sicas)

#### ğŸ¥ **Funcionalidad MÃ©dica** (15 pruebas)
- CreaciÃ³n y gestiÃ³n de citas
- Flujo de estados (pendiente â†’ confirmado â†’ atendido)
- Relaciones paciente-doctor-sede
- ValidaciÃ³n de horarios y especialidades

#### ğŸ¢ **Operaciones** (18 pruebas)
- GestiÃ³n de horarios mÃ©dicos
- AdministraciÃ³n de pacientes
- Operaciones de cajero y facturaciÃ³n
- Funciones de superadmin

#### âš–ï¸ **LÃ³gica de Negocio** (6 pruebas)
- ValidaciÃ³n de horarios no superpuestos
- Control de citas duplicadas
- Estados de citas vÃ¡lidos
- Doctores con especialidad asignada

### Usuarios de Prueba Verificados
El test confirma que estos usuarios funcionan al **100%**:
- âœ… `super@demo.local` - Super Demo (superadmin)
- âœ… `doctor@demo.local` - Doctor Demo (doctor)
- âœ… `paciente@demo.local` - Paciente Demo (paciente)
- âœ… `cajero@demo.local` - Cajero Demo (cajero)

### Verificaciones Adicionales
```bash
# Verificar API endpoints
curl http://localhost:8000/api/appointments

# Test de funcionalidades especÃ­ficas
# El sistema ejecuta automÃ¡ticamente 69 validaciones individuales
```

## ğŸ“ ESTRUCTURA DEL PROYECTO

```
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Controllers/     # Controladores MVC
â”‚   â”œâ”€â”€ Core/           # Sistema base (Router, Auth, Eloquent)
â”‚   â”œâ”€â”€ Models/         # Modelos Eloquent
â”‚   â””â”€â”€ Middleware/     # Middleware de autenticaciÃ³n
â”œâ”€â”€ public/             # Punto de entrada web
â”œâ”€â”€ routes/             # DefiniciÃ³n de rutas
â”œâ”€â”€ views/              # Templates PHP
â”œâ”€â”€ sql/                # Scripts de base de datos
â””â”€â”€ vendor/             # Dependencias Composer
```

## âš ï¸ NOTAS IMPORTANTES

1. **Compatibilidad**: El sistema mantiene 100% compatibilidad con cÃ³digo existente
2. **Performance**: Eloquent optimiza automÃ¡ticamente las consultas
3. **Seguridad**: ProtecciÃ³n automÃ¡tica contra SQL injection
4. **Escalabilidad**: Preparado para crecimiento futuro
5. **Testing**: Sistema verificado con 69 pruebas automatizadas (100% Ã©xito)
6. **Usuarios Demo**: Los usuarios `@demo.local` estÃ¡n diseÃ±ados especÃ­ficamente para testing
7. **Entorno de ProducciÃ³n**: Los usuarios `@clinicasanjose.com` simulan un entorno real

## ğŸ› SOLUCIÃ“N DE PROBLEMAS

### Error de ConexiÃ³n a BD
- Verificar credenciales en `.env`
- Comprobar que el servicio de BD estÃ© activo
- Verificar extensiones PHP: `pdo_sqlsrv` o `pdo_mysql`

### Test Fallando
```bash
# Si el test no alcanza 100%, verificar:
# 1. Base de datos configurada correctamente
# 2. Usuarios demo creados (ejecutar schema.sql completo)
# 3. Extensiones PHP instaladas
php test_sistema_citas.php
```

### Error de Composer
```bash
composer install --ignore-platform-reqs
composer dump-autoload
```

### Error de Permisos
- Asegurar permisos de escritura en directorios de logs
- Verificar permisos de BD para el usuario configurado

### Usuarios Demo No Encontrados
Si el test falla porque no encuentra usuarios `@demo.local`:
```sql
-- Ejecutar esta secciÃ³n del schema.sql:
-- ============================================
-- INSERTAR USUARIOS DEMO CON @demo.local
-- ============================================
```

---
