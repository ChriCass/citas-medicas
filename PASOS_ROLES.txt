# PASOS DE INSTALACIÃ“N - SISTEMA DE CITAS MÃ‰DICAS CON ELOQUENT ORM

## ğŸ“‹ PREPARACIÃ“N INICIAL

### 1. ConfiguraciÃ³n del Entorno
```bash
# Copiar archivo de configuraciÃ³n
cp .env.example .env
```

### 2. Configurar Base de Datos en .env
```env
# Para SQL Server
DB_CONNECTION=sqlsrv
DB_HOST=localhost
DB_PORT=1433
DB_DATABASE=med_database_v5
DB_USERNAME=tu_usuario
DB_PASSWORD=tu_password

# Para MySQL (alternativa)
DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=med_database_v5
DB_USERNAME=tu_usuario
DB_PASSWORD=tu_password
```

### 3. Instalar Dependencias de Eloquent ORM
```bash
# Instalar Eloquent y dependencias relacionadas
composer require illuminate/database
composer require illuminate/events
composer require nesbot/carbon

# Regenerar autoloader
composer dump-autoload
```

## ğŸ—„ï¸ CONFIGURACIÃ“N DE BASE DE DATOS

### 4. Configurar Base de Datos (SQL Server)
1. Crea una nueva base de datos llamada `med_database_v5` en tu SQL Server
2. Ejecuta el script completo del archivo `sql/SQLServer_EspaÃ±ol/schema.sql` que incluye:
   - CreaciÃ³n de todas las tablas
   - InserciÃ³n de datos de prueba (usuarios, roles, especialidades, etc.)
   - ConfiguraciÃ³n de relaciones y constraints

### 5. Alternativa MySQL
Si prefieres usar MySQL, ejecuta:
```sql
-- Crear la base de datos
CREATE DATABASE med_database_v5;

-- Ejecutar el script de MySQL
mysql -u usuario -p med_database_v5 < sql/mysql/schema.sql
```

## âš™ï¸ CONFIGURACIÃ“N DE ELOQUENT

### 6. InicializaciÃ³n AutomÃ¡tica
El sistema estÃ¡ configurado para inicializar Eloquent automÃ¡ticamente:
- `app/Core/Eloquent.php` - ConfiguraciÃ³n principal
- `app/Core/Database.php` - Fallback para compatibilidad
- Todos los modelos heredan de `BaseModel` con funcionalidades Eloquent

### 7. Verificar InstalaciÃ³n
```bash
# Ejecutar test completo de Eloquent
php test_eloquent_completo.php
```

El test debe mostrar **51/51 pruebas exitosas (100%)**.

## ğŸš€ EJECUTAR EL SISTEMA

### 8. Iniciar Servidor
```bash
# Servidor de desarrollo PHP
php -S localhost:8000 -t public
```

### 9. Acceder al Sistema
- **URL**: http://localhost:8000
- **Usuarios Demo** (password: `password`):
  - superadmin@clinicasanjose.com
  - doctor@clinicasanjose.com  
  - paciente@clinicasanjose.com
  - cajero@clinicasanjose.com

## ğŸ‘¥ ROLES Y PERMISOS

### SUPERADMIN
- âœ… Ver todas las citas
- âœ… Crear nuevas citas (/citas/create)
- âœ… Gestionar doctores y horarios
- âœ… Acceso completo al sistema

### DOCTOR
- âœ… Ver todas las citas del sistema
- âŒ No puede crear citas
- âŒ No puede cambiar estados de citas
- âœ… Gestionar sus horarios

### PACIENTE  
- âœ… Ver solo sus propias citas
- âŒ No puede crear citas
- âŒ No puede cambiar estados
- âœ… Cancelar citas (con restricciones de tiempo)

### CAJERO
- âœ… Ver todas las citas
- âœ… Cambiar estados de citas (pendiente/confirmado/cancelado)
- âŒ No puede crear nuevas citas
- âœ… Gestionar pagos y confirmaciones

## ğŸ”§ CARACTERÃSTICAS DE ELOQUENT

### Beneficios Implementados
- **Relaciones automÃ¡ticas**: User->Doctor, Doctor->Especialidad, etc.
- **Query Builder avanzado**: Consultas complejas simplificadas
- **Eager Loading**: Carga eficiente de relaciones
- **Accessors/Mutators**: TransformaciÃ³n automÃ¡tica de datos
- **Transacciones**: Operaciones seguras en BD
- **Validaciones**: Reglas de negocio integradas

### Modelos Disponibles
- `User` - GestiÃ³n de usuarios con roles
- `Doctor` - Perfiles de doctores
- `Paciente` - Perfiles de pacientes  
- `Appointment` - Sistema de citas
- `Especialidad` - Especialidades mÃ©dicas
- `Sede` - Sedes y ubicaciones
- `Role` - Sistema de roles

## ğŸ§ª TESTING

### Ejecutar Tests
```bash
# Test completo de migraciÃ³n
php test_eloquent_completo.php

# Verificar funcionalidades especÃ­ficas
curl http://localhost:8000/api/appointments
```

## ğŸ“ ESTRUCTURA DEL PROYECTO

```
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Controllers/     # Controladores MVC
â”‚   â”œâ”€â”€ Core/           # Sistema base (Router, Auth, Eloquent)
â”‚   â”œâ”€â”€ Models/         # Modelos Eloquent
â”‚   â””â”€â”€ Middleware/     # Middleware de autenticaciÃ³n
â”œâ”€â”€ public/             # Punto de entrada web
â”œâ”€â”€ routes/             # DefiniciÃ³n de rutas
â”œâ”€â”€ views/              # Templates PHP
â”œâ”€â”€ sql/                # Scripts de base de datos
â””â”€â”€ vendor/             # Dependencias Composer
```

## âš ï¸ NOTAS IMPORTANTES

1. **Compatibilidad**: El sistema mantiene 100% compatibilidad con cÃ³digo existente
2. **Performance**: Eloquent optimiza automÃ¡ticamente las consultas
3. **Seguridad**: ProtecciÃ³n automÃ¡tica contra SQL injection
4. **Escalabilidad**: Preparado para crecimiento futuro

## ğŸ› SOLUCIÃ“N DE PROBLEMAS

### Error de ConexiÃ³n a BD
- Verificar credenciales en `.env`
- Comprobar que el servicio de BD estÃ© activo
- Verificar extensiones PHP: `pdo_sqlsrv` o `pdo_mysql`

### Error de Composer
```bash
composer install --ignore-platform-reqs
composer dump-autoload
```

### Error de Permisos
- Asegurar permisos de escritura en directorios de logs
- Verificar permisos de BD para el usuario configurado

---
